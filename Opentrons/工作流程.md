# 工作流程

## 模拟脚本

通常，模拟协议的最佳方法是通过Opentrons应用程序将其上传到OT-2。当您通过应用程序上传协议时，OT-2会模拟协议，应用程序会显示任何错误。

**但是，如果您想在不连接到OT-2的情况下模拟协议，可以下载Opentrons Python包（参考环境配置章节）**。

### 命令行

一旦Opentrons Python包安装完成，就可以在终端中使用`opentrons_simulate`命令模拟协议：

```bash
$ opentrons_simulate my_protocol.py
```

与Opentrons App类似，模拟器将会打印协议将要执行的动作的日志。如果协议有问题，模拟将停止，并打印错误。

模拟脚本也可以通过python调用：

```bash
$ python3 -m opentrons.simulate /path/to/protocol.py
```

查看`opentrons_simulate`命令选项：

```bash
$ opentrons_simulate --help
```

### 使用自定义的实验器具

默认的，`opentrons_simulate`将从运行目录中加载自定义的实验器具。

修改`opentrons_simulate`搜索自定义实验器具的目录：

```shell
python.exe -m opentrons.simulate --custom-labware-path="C:\Custom Labware"
```

### Python脚本

```python
from opentrons.simulate import simulate, format_runlog
# read the file
protocol_file = open('/path/to/protocol.py')
# simulate() the protocol, keeping the runlog
runlog, _bundle = simulate(protocol_file)
# print the runlog
print(format_runlog(runlog))
```

`opentrons.simulate.simulate() `方法模拟协议，返回一个结构化的字典列表的运行日志。

使用`opentrons.simulate.format_runlog()`将日志变得可读。

```python
from opentrons.simulate import simulate, format_runlog

# read the file
protocol_file = open('/path/to/protocol.py')
custom_labware_path = './custom_labware/'
# simulate() the protocol, keeping the runlog
runlog, _bundle = simulate(protocol_file, custom_labware_paths=[custom_labware_path])
# print the runlog
print(format_runlog(runlog))
```

`custom_labware_path`配置自定义的实验器具的路径。

## 配置和本地存储

`Opentrons Python包`的配置和内部数据存储在用户目录下：`~/.opentrons`。

## API配置流程

一个协议的基本格式如下：

1. 协议制定者、协议的用途
   1. 协议名字
   2. 联系方式
   3. 协议描述
   4. 协议使用的api版本（必要）
2. 告诉机器人在哪里寻找实验器具、移液器和一些硬件模块（可选）
3. 命令机器人控制其连接的硬件

**[示例]**

如果我们需要OT-2在一个板子上从孔A1到孔B1进行移液，协议如下。

```python
from opentrons import protocol_api

# metadata
metadata = {
    'protocolName': 'My Protocol',
    'author': 'Name <opentrons@example.com>',
    'description': 'Simple protocol to get started using the OT-2',
    'apiLevel': '2.13'
}

# protocol run function
def run(protocol: protocol_api.ProtocolContext):

    # labware
    plate = protocol.load_labware('corning_96_wellplate_360ul_flat', location='1')
    tiprack = protocol.load_labware('opentrons_96_tiprack_300ul', location='2')

    # pipettes
    left_pipette = protocol.load_instrument(
         'p300_single', mount='left', tip_racks=[tiprack])

    # commands
    left_pipette.pick_up_tip()
    left_pipette.aspirate(100, plate['A1'])
    left_pipette.dispense(100, plate['B2'])
    left_pipette.drop_tip()
```

上诉代码描述如下信息：

1. 提供协议的名称、联系信息和简短描述。表明协议可以运行的API的最低版本。
2. 告诉机器人有：
   1. 槽1中的96孔平板。
   2. 槽2中有300µL枪头的支架。
   3. 一个单通道300µL移液器连接在左侧挂载点上，该移液管应从上述枪头支架上取枪头。
3. 告诉机器人动作：
   1. 从枪头支架上拾取第一个Tip头。
   2. 从平板的孔A1吸入100µL液体。
   3. 将100µL液体分配到平板的孔B1中。
   4. 把Tip扔到垃圾桶里。

## 默认的实验器具

[Opentrons Labware Library](https://labware.opentrons.com/)

OT-2有一系列内部定义好的实验器具。

## 自定义实验器具

[Opentrons Labware Creator](
