# 复杂命令

下面的例子使用如下设置：

```python
from opentrons import protocol_api

metadata = {'apiLevel': '2.13'}

def run(protocol: protocol_api.ProtocolContext):
    plate = protocol.load_labware('corning_96_wellplate_360ul_flat', 1)
    tiprack = protocol.load_labware('opentrons_96_tiprack_300ul', 2)
    tiprack_multi = protocol.load_labware('opentrons_96_tiprack_300ul', 3)
    pipette = protocol.load_instrument('p300_single', mount='left', tip_racks=[tiprack])
    pipette_multi = protocol.load_instrument('p300_multi', mount='right', tip_racks=[tiprack_multi])

    # The code used in the rest of the examples goes here
```

**转移**
![img](https://cdn.jsdelivr.net/gh/sfdsv/pic/img/202302132206280.png)

**分发**
![img](https://docs.opentrons.com/v2/_images/robot_distribute.png)

**合并**
![images/robot_consolidate.png](https://cdn.jsdelivr.net/gh/sfdsv/pic/img/202302132209449.png)

## 转移液体

从孔A1到孔B1转移100ul液体，使用P300单通道移液器，自动换新的tip头然后丢弃:

```python
pipette.transfer(100, plate.wells_by_name()['A1'], plate.wells_by_name()['B1'])
```

当使用多通道移液器时，可以转移这个板子上的整列(8孔)到另一个：

```python
pipette.transfer(100, plate.wells_by_name()['A1'], plate.wells_by_name()['A2'])
```

### 大体积

如果转移体积大于移液器最大体积(见[Defaults](https://docs.opentrons.com/v2/new_pipette.html#defaults))，将自动分成更小的体积转移。

```python
piette.transfer(700, plate.wells_by_name()['A2'], plate.wells_by_name()['B2'])
```

将执行以下步骤：

```python
Transferring 700 from well A2 in "1" to well B2 in "1"
Picking up tip well A1 in "2"
Aspirating 300.0 uL from well A2 in "1" at 1 speed
Dispensing 300.0 uL into well B2 in "1"
Aspirating 200.0 uL from well A2 in "1" at 1 speed
Dispensing 200.0 uL into well B2 in "1"
Aspirating 200.0 uL from well A2 in "1" at 1 speed
Dispensing 200.0 uL into well B2 in "1"
Dropping tip well A1 in "12"
```

### 1-1

超有用的。

```python
pipette.transfer(100, plate.columns_by_name()['1'], plate.columns_by_name()['2'])
```

将执行以下步骤：

```python
Transferring 100 from wells A1...H1 in "1" to wells A2...H2 in "1"
Picking up tip well A1 in "2"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well A2 in "1"
Aspirating 100.0 uL from well B1 in "1" at 1 speed
Dispensing 100.0 uL into well B2 in "1"
Aspirating 100.0 uL from well C1 in "1" at 1 speed
Dispensing 100.0 uL into well C2 in "1"
Aspirating 100.0 uL from well D1 in "1" at 1 speed
Dispensing 100.0 uL into well D2 in "1"
Aspirating 100.0 uL from well E1 in "1" at 1 speed
Dispensing 100.0 uL into well E2 in "1"
Aspirating 100.0 uL from well F1 in "1" at 1 speed
Dispensing 100.0 uL into well F2 in "1"
Aspirating 100.0 uL from well G1 in "1" at 1 speed
Dispensing 100.0 uL into well G2 in "1"
Aspirating 100.0 uL from well H1 in "1" at 1 speed
Dispensing 100.0 uL into well H2 in "1"
Dropping tip well A1 in "12"
```

### 1-n

```python
pipette.transfer(100, plate.wells_by_name()['A1'], plate.columns_by_name()['2'])
```

将会执行以下步骤：

```python
Transferring 100 from well A1 in "1" to wells A2...H2 in "1"
Picking up tip well A1 in "2"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well A2 in "1"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well B2 in "1"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well C2 in "1"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well D2 in "1"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well E2 in "1"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well F2 in "1"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well G2 in "1"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well H2 in "1"
Dropping tip well A1 in "12"
```

### 体积列表

可以传递一个体积列表，而不是将单孔体积用于所有源/目标孔。

```python
pipette.transfer(
    [20, 40, 60],
    plate['A1'],
    [plate.wells_by_name()[well_name] for well_name in ['B1', 'B2', 'B3']])
```

将执行以下步骤：

```python
Transferring [20, 40, 60] from well A1 in "1" to wells B1...B3 in "1"
Picking up tip well A1 in "2"
Aspirating 20.0 uL from well A1 in "1" at 1 speed
Dispensing 20.0 uL into well B1 in "1"
Aspirating 40.0 uL from well A1 in "1" at 1 speed
Dispensing 40.0 uL into well B2 in "1"
Aspirating 60.0 uL from well A1 in "1" at 1 speed
Dispensing 60.0 uL into well B3 in "1"
Dropping tip well A1 in "12"
```

### 跳过孔

可以通过将体积设置为0来跳过某些孔。

```python
pipette.transfer(
    [20, 0, 60],
    plate['A1'],
    [plate.wells_by_name()[well_name] for well_name in ['B1', 'B2', 'B3']])
```

将执行以下步骤：

```python
Transferring [20, 40, 60] from well A1 in "1" to wells B1...B3 in "1"
Picking up tip well A1 in "2"
Aspirating 20.0 uL from well A1 in "1" at 1 speed
Dispensing 20.0 uL into well B1 in "1"
Aspirating 60.0 uL from well A1 in "1" at 1 speed
Dispensing 60.0 uL into well B3 in "1"
Dropping tip well A1 in "12"
```

## 分发和合并液体

分发和合并与转移类似，但存在特定用途。

### 合并

多孔吸液，喷到同一个孔里，不换tip头。

```python
pipette.consolidate(30, plate.columns_by_name()['2'], plate.wells_by_name()['A1'])
```

将执行以下步骤：

```python
Consolidating 30 from wells A2...H2 in "1" to well A1 in "1"
Transferring 30 from wells A2...H2 in "1" to well A1 in "1"
Picking up tip well A1 in "2"
Aspirating 30.0 uL from well A2 in "1" at 1 speed
Aspirating 30.0 uL from well B2 in "1" at 1 speed
Aspirating 30.0 uL from well C2 in "1" at 1 speed
Aspirating 30.0 uL from well D2 in "1" at 1 speed
Aspirating 30.0 uL from well E2 in "1" at 1 speed
Aspirating 30.0 uL from well F2 in "1" at 1 speed
Aspirating 30.0 uL from well G2 in "1" at 1 speed
Aspirating 30.0 uL from well H2 in "1" at 1 speed
Dispensing 240.0 uL into well A1 in "1"
Dropping tip well A1 in "12"
```

如果存在多个目的孔，移液器将不会结合这一次转移，而是从一个源孔吸液，喷进它的目的孔，然后从下一个源孔吸液。

```python
pipette.consolidate(
  30,
  plate.columns_by_name()['1'],
  [plate.wells_by_name()[well_name] for well_name in ['A1', 'A2']])
```

将执行以下步骤：

```python
Consolidating 30 from wells A1...H1 in "1" to wells A1...A2 in "1"
Transferring 30 from wells A1...H1 in "1" to wells A1...A2 in "1"
Picking up tip well A1 in "2"
Aspirating 30.0 uL from well A1 in "1" at 1 speed
Aspirating 30.0 uL from well B1 in "1" at 1 speed
Aspirating 30.0 uL from well C1 in "1" at 1 speed
Aspirating 30.0 uL from well D1 in "1" at 1 speed
Dispensing 120.0 uL into well A1 in "1"
Aspirating 30.0 uL from well E1 in "1" at 1 speed
Aspirating 30.0 uL from well F1 in "1" at 1 speed
Aspirating 30.0 uL from well G1 in "1" at 1 speed
Aspirating 30.0 uL from well H1 in "1" at 1 speed
Dispensing 120.0 uL into well A2 in "1"
Dropping tip well A1 in "12"
```

### 分发

从同一个孔吸液，喷到不同的孔，不换枪头。

```python
pipette.distribute(55, plate.wells_by_name()['A1'], plate.rows_by_name()['A'])
```

将执行以下步骤：
```python
Distributing 55 from well A1 in "1" to wells A1...A12 in "1"
Transferring 55 from well A1 in "1" to wells A1...A12 in "1"
Picking up tip well A1 in "2"
Aspirating 250.0 uL from well A1 in "1" at 1 speed
Dispensing 55.0 uL into well A1 in "1"
Dispensing 55.0 uL into well A2 in "1"
Dispensing 55.0 uL into well A3 in "1"
Dispensing 55.0 uL into well A4 in "1"
Blowing out at well A1 in "12"
Aspirating 250.0 uL from well A1 in "1" at 1 speed
Dispensing 55.0 uL into well A5 in "1"
Dispensing 55.0 uL into well A6 in "1"
Dispensing 55.0 uL into well A7 in "1"
Dispensing 55.0 uL into well A8 in "1"
Blowing out at well A1 in "12"
Aspirating 250.0 uL from well A1 in "1" at 1 speed
Dispensing 55.0 uL into well A9 in "1"
Dispensing 55.0 uL into well A10 in "1"
Dispensing 55.0 uL into well A11 in "1"
Dispensing 55.0 uL into well A12 in "1"
Blowing out at well A1 in "12"
Dropping tip well A1 in "12"
```

如果存在多个吸液孔，那么移液器也不会合并这些体积进同一个tip头。

```python
pipette.distribute(
  30,
  [plate.wells_by_name()[well_name] for well_name in ['A1', 'A2']],
  plate.rows()['A'])
```

将执行以下步骤：

```python
Distributing 30 from wells A1...A2 in "1" to wells A1...A12 in "1"
Transferring 30 from wells A1...A2 in "1" to wells A1...A12 in "1"
Picking up tip well A1 in "2"
Aspirating 210.0 uL from well A1 in "1" at 1 speed
Dispensing 30.0 uL into well A1 in "1"
Dispensing 30.0 uL into well A2 in "1"
Dispensing 30.0 uL into well A3 in "1"
Dispensing 30.0 uL into well A4 in "1"
Dispensing 30.0 uL into well A5 in "1"
Dispensing 30.0 uL into well A6 in "1"
Blowing out at well A1 in "12"
Aspirating 210.0 uL from well A2 in "1" at 1 speed
Dispensing 30.0 uL into well A7 in "1"
Dispensing 30.0 uL into well A8 in "1"
Dispensing 30.0 uL into well A9 in "1"
Dispensing 30.0 uL into well A10 in "1"
Dispensing 30.0 uL into well A11 in "1"
Dispensing 30.0 uL into well A12 in "1"
Blowing out at well A1 in "12"
Dropping tip well A1 in "12"
```

###  **体积列表**

可以传递一个体积列表，而不是将一个体积用于所有源/目的孔。

* 分发

```python
pipette.distribute(
    [20, 40, 60],
    plate['A1'],
    [plate.wells_by_name()[well_name] for well_name in ['B1', 'B2', 'B3']])
```

将执行以下步骤：

```python
Distributing [20, 40, 60] from well A1 in "1" to wells B1...B3 in "1"
Picking up tip well A1 in "2"
Aspirating 150.0 uL from well A1 in "1" at 1 speed
Dispensing 20.0 uL into well B1 in "1"
Dispensing 40.0 uL into well B2 in "1"
Dispensing 60.0 uL into well B3 in "1"
Blowing out in well A1 in "12"
Dropping tip well A1 in "12"
```

* 合并

```python
pipette.consolidate(
    [20, 40, 60],
    [plate.wells_by_name()[well_name] for well_name in ['B1', 'B2', 'B3']],
    plate['A1'])
```

将执行以下步骤：

```python
Consolidating [20, 40, 60] from wells B1...B3 in "1" to well A1 in "1"
Picking up tip well A1 in "2"
Aspirating 20.0 uL from well B1 in "1"
Aspirating 40.0 uL into well B2 in "1"
Aspirating 60.0 uL into well B3 in "1"
Dispensing 120.0 uL into well A1 in "1"
Dropping tip well A1 in "12"
```

### **跳过孔**

通过设置体积为0可以跳过某些孔。

```python
pipette.distribute(
    [20, 40, 60, 0, 0, 0, 50, 100],
    plate['A1'],
    plate.columns_by_name()['2'])
```

将执行以下步骤：

```python
Distributing [20, 40, 60] from well A1 in "1" to column 2 in "1"
Picking up tip well A1 in "2"
Aspirating 300.0 uL from well A1 in "1" at 1 speed
Dispensing 20.0 uL into well A2 in "1"
Dispensing 40.0 uL into well B2 in "1"
Dispensing 60.0 uL into well C2 in "1"
Dispensing 50.0 uL into well G2 in "1"
Dispensing 100.0 uL into well H2 in "1"
Blowing out in well A1 in "12"
Dropping tip well A1 in "12"
```

## 操作序列

复杂命令的参数控制行为。但是操作的序列不可变。

1. tip逻辑

2. 在源孔混匀

3. 吸液+可能存在的处理体积

4. 触摸tip

5. 空气间隙

6. 喷液

7. 触摸tip

   <----------重复以上步骤用于所有孔------------->

8. 将处理体积喷进垃圾桶置空，如果存在
9. 吹出

注意，只有在`去除处理体积`后才会发生`吹出`。如果你想要在每次`喷液`后`吹出`，你不应该包含处理体积。

## 液体操作参数

### new_tip

选项: `'always'`, `'once'`(默认) and `'never'`

* **总是获取一个新的tip头**

每次吸液前，都会获取一个新tip头。

```python
pipette.transfer(
    100,
    [plate.wells_by_name()[well_name] for well_name in ['A1', 'A2', 'A3']],
    [plate.wells_by_name()[well_name] for well_name in ['B1', 'B2', 'B3']],
    new_tip='always')    # always pick up a new tip
```

将执行以下步骤：

```python
Transferring 100 from wells A1...A3 in "1" to wells B1...B3 in "1"
Picking up tip well A1 in "2"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well B1 in "1"
Dropping tip well A1 in "12"
Picking up tip well B1 in "2"
Aspirating 100.0 uL from well A2 in "1" at 1 speed
Dispensing 100.0 uL into well B2 in "1"
Dropping tip well A1 in "12"
Picking up tip well C1 in "2"
Aspirating 100.0 uL from well A3 in "1" at 1 speed
Dispensing 100.0 uL into well B3 in "1"
Dropping tip well A1 in "12"
```

* **不获取一个新tip头**

在协议中，转移指令会忽略取退tip头。

```python
pipette.pick_up_tip()
...
pipette.transfer(
    100,
    [plate.wells_by_name()[well_name] for well_name in ['A1', 'A2', 'A3']],
    [plate.wells_by_name()[well_name] for well_name in ['B1', 'B2', 'B3']],
    new_tip='never')    # never pick up or drop a tip
...
pipette.drop_tip()
```

将执行以下步骤：

```python
Picking up tip well A1 in "2"
...
Transferring 100 from wells A1...A3 in "1" to wells B1...B3 in "1"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well B1 in "1"
Aspirating 100.0 uL from well A2 in "1" at 1 speed
Dispensing 100.0 uL into well B2 in "1"
Aspirating 100.0 uL from well A3 in "1" at 1 speed
Dispensing 100.0 uL into well B3 in "1"
...
Dropping tip well A1 in "12"
```

* **使用一个tip头**

```python
pipette.transfer(
    100,
    [plate.wells_by_name()[well_name] for well_name in ['A1', 'A2', 'A3']],
    [plate.wells_by_name()[well_name] for well_name in ['B1', 'B2', 'B3']],
    new_tip='once')    # use one tip (default behavior)
```

将执行以下步骤：

```python
Picking up tip well A1 in "2"
Transferring 100 from wells A1...A3 in "1" to wells B1...B3 in "1"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well B1 in "1"
Aspirating 100.0 uL from well A2 in "1" at 1 speed
Dispensing 100.0 uL into well B2 in "1"
Aspirating 100.0 uL from well A3 in "1" at 1 speed
Dispensing 100.0 uL into well B3 in "1"
Dropping tip well A1 in "12"
```

### trash

复杂的命令默认会丢弃移液器的tip头到垃圾桶里。

可以通过设置`trash=False`返回tip头到它的tip盒。

```python
pipette.transfer(
    100,
    plate['A1'],
    plate['B1'],
    trash=False)       # do not trash tip
```

将执行以下步骤：

```python
Transferring 100 from well A1 in "1" to well B1 in "1"
Picking up tip well A1 in "2"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well B1 in "1"
Returning tip
Dropping tip well A1 in "2"
```

### touch_tip

通过设置`touch_tip=True`可以在每次吸液和喷液后执行。

```python
pipette.transfer(
    100,
    plate['A1'],
    plate['A2'],
    touch_tip=True)     # touch tip to each well's edge
```

将执行以下步骤：

```python
Transferring 100 from well A1 in "1" to well A2 in "1"
Picking up tip well A1 in "2"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Touching tip
Dispensing 100.0 uL into well A2 in "1"
Touching tip
Dropping tip well A1 in "12"
```

### blow_out

通过设置`blow_out=True`可以让每次喷液后都去垃圾桶执行吹出动作，为了让tip头内置空。

```python
pipette.transfer(
    100,
    plate['A1'],
    plate['A2'],
    blow_out=True)      # blow out droplets when tip is empty
```

将执行以下步骤：

```python
Transferring 100 from well A1 in "1" to well A2 in "1"
Picking up tip well A1 in "2"
Aspirating 100.0 uL from well A1 in "1" at 1 speed
Dispensing 100.0 uL into well A2 in "1"
Blowing out
Dropping tip well A1 in "12"
```

The robot will automatically dispense any left over liquid that is not from using disposal_volume into the source well of your transfer function.

机器人自动的将转移剩余的液体喷回转移函数的源孔。

```python
pipette.pick_up_tip()
pipette.aspirate(10, plate['A1'])
pipette.transfer(
    100,
    plate['A1'],
    plate['A2'],
    blow_out=True,   # blow out droplets into the source well (A1 of "plate")
    new_tip='never')
```

### blowout_location

### mix_before, mix_after

### air_gap

### disposal_volume

在分发指令中，当使用同一个吸头喷多次的时候，建议在分发后吸额外的液体进行处理。

这被增加的`disposal_volume`可以被设置作为一个可选参数。
